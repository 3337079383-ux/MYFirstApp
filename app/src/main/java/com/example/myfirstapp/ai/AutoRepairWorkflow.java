package com.example.myfirstapp.ai;

/**
 * è‡ªåŠ¨åŒ–ä¿®å¤å·¥ä½œæµå¼•æ“
 * æ‰§è¡Œå®‰å…¨å®¡è®¡ã€æ£€æµ‹æ¼æ´ã€åˆ†ææ ¹å› å¹¶è‡ªåŠ¨ä¿®å¤
 *
 * å·¥ä½œæµç¨‹:
 * 1. è¿è¡Œå…¨é¢å®‰å…¨å®¡è®¡
 * 2. åˆ†æå¤±è´¥æµ‹è¯•ç”¨ä¾‹
 * 3. è¯†åˆ«ä¿®å¤ç­–ç•¥
 * 4. åº”ç”¨è‡ªåŠ¨ä¿®å¤
 * 5. é‡æ–°éªŒè¯ä¿®å¤æ•ˆæœ
 * 6. ç”Ÿæˆä¿®å¤æŠ¥å‘Š
 */
public class AutoRepairWorkflow {

    private GomokuSecurityAudit å®‰å…¨å®¡è®¡ç³»ç»Ÿ;
    private GomokuAI aiå¼•æ“;

    // ä¿®å¤ç»Ÿè®¡
    private int å°è¯•ä¿®å¤æ•° = 0;
    private int æˆåŠŸä¿®å¤æ•° = 0;
    private int å¤±è´¥ä¿®å¤æ•° = 0;

    public AutoRepairWorkflow() {
        this.å®‰å…¨å®¡è®¡ç³»ç»Ÿ = new GomokuSecurityAudit();
        this.aiå¼•æ“ = new GomokuAI(GomokuAI.éš¾åº¦ç­‰çº§.å¤§å¸ˆ);
        this.aiå¼•æ“.setLoggingEnabled(true);
    }

    /**
     * ä¸»ä¿®å¤å·¥ä½œæµ - è‡ªåŠ¨åŒ–æ¼æ´æ£€æµ‹å’Œä¿®å¤
     */
    public RepairReport æ‰§è¡Œè‡ªåŠ¨ä¿®å¤() {
        æ‰“å°ä¿®å¤å¼€å§‹ä¿¡æ¯();

        // ç¬¬ä¸€æ­¥: è¿è¡Œåˆå§‹å®‰å…¨å®¡è®¡
        GomokuSecurityAudit.å®¡è®¡ç»“æœ åˆå§‹ç»“æœ = å®‰å…¨å®¡è®¡ç³»ç»Ÿ.æ‰§è¡Œå®Œæ•´å®¡è®¡();

        if (!åˆå§‹ç»“æœ.éœ€è¦ä¿®å¤()) {
            return new RepairReport(0, 0, 0, åˆå§‹ç»“æœ, åˆå§‹ç»“æœ, "æ— éœ€ä¿®å¤ - AIç³»ç»Ÿè¿è¡Œå®Œç¾");
        }

        // ç¬¬äºŒæ­¥: åˆ†æå¤±è´¥ç”¨ä¾‹å¹¶åº”ç”¨ä¿®å¤ç­–ç•¥
        for (String å¤±è´¥è¯¦æƒ… : åˆå§‹ç»“æœ.å¤±è´¥è¯¦æƒ…) {
            å°è¯•ä¿®å¤æ•°++;

            boolean ä¿®å¤æˆåŠŸ = åˆ†æå¹¶ä¿®å¤å¤±è´¥ç”¨ä¾‹(å¤±è´¥è¯¦æƒ…);

            if (ä¿®å¤æˆåŠŸ) {
                æˆåŠŸä¿®å¤æ•°++;
            } else {
                å¤±è´¥ä¿®å¤æ•°++;
            }
        }

        // ç¬¬ä¸‰æ­¥: é‡æ–°è¿è¡Œå®Œæ•´å®¡è®¡éªŒè¯ä¿®å¤æ•ˆæœ
        GomokuSecurityAudit.å®¡è®¡ç»“æœ ä¿®å¤åç»“æœ = å®‰å…¨å®¡è®¡ç³»ç»Ÿ.æ‰§è¡Œå®Œæ•´å®¡è®¡();

        // ç¬¬å››æ­¥: ç”Ÿæˆä¿®å¤æŠ¥å‘Š
        String ä¿®å¤æ‘˜è¦ = ç”Ÿæˆä¿®å¤æ‘˜è¦(åˆå§‹ç»“æœ, ä¿®å¤åç»“æœ);

        return new RepairReport(å°è¯•ä¿®å¤æ•°, æˆåŠŸä¿®å¤æ•°, å¤±è´¥ä¿®å¤æ•°, åˆå§‹ç»“æœ, ä¿®å¤åç»“æœ, ä¿®å¤æ‘˜è¦);
    }

    /**
     * åˆ†æå¤±è´¥ç”¨ä¾‹å¹¶åº”ç”¨ç›¸åº”ä¿®å¤ç­–ç•¥
     */
    private boolean åˆ†æå¹¶ä¿®å¤å¤±è´¥ç”¨ä¾‹(String å¤±è´¥è¯¦æƒ…) {
        System.out.println("\\næ­£åœ¨åˆ†æå¤±è´¥ç”¨ä¾‹: " + å¤±è´¥è¯¦æƒ…);

        // 1. ç¬é—´æˆäº”é˜²å¾¡ä¿®å¤ç­–ç•¥
        if (å¤±è´¥è¯¦æƒ….contains("ç¬é—´æˆäº”") || å¤±è´¥è¯¦æƒ….contains("æ´»å››")) {
            return ä¿®å¤ç¬é—´æˆäº”é˜²å¾¡();
        }

        // 2. æ´»ä¸‰å¨èƒæ£€æµ‹ä¿®å¤ç­–ç•¥
        if (å¤±è´¥è¯¦æƒ….contains("æ´»ä¸‰") && å¤±è´¥è¯¦æƒ….contains("å¨èƒ")) {
            return ä¿®å¤æ´»ä¸‰å¨èƒæ£€æµ‹();
        }

        // 3. VCFæ”»å‡»é˜²å¾¡ä¿®å¤ç­–ç•¥
        if (å¤±è´¥è¯¦æƒ….contains("VCF") || å¤±è´¥è¯¦æƒ….contains("è¿ç»­å†²å››")) {
            return ä¿®å¤VCFæ”»å‡»é˜²å¾¡();
        }

        // 4. æ€§èƒ½ä¼˜åŒ–ä¿®å¤ç­–ç•¥
        if (å¤±è´¥è¯¦æƒ….contains("æ€§èƒ½") || å¤±è´¥è¯¦æƒ….contains("è¶…æ—¶")) {
            return ä¿®å¤æ€§èƒ½é—®é¢˜();
        }

        // 5. é€»è¾‘ä¸€è‡´æ€§ä¿®å¤ç­–ç•¥
        if (å¤±è´¥è¯¦æƒ….contains("ä¸€è‡´æ€§") || å¤±è´¥è¯¦æƒ….contains("ä¸ä¸€è‡´")) {
            return ä¿®å¤é€»è¾‘ä¸€è‡´æ€§();
        }

        // 6. é€šç”¨é˜²å¾¡å¼ºåŒ–ç­–ç•¥
        return åº”ç”¨é€šç”¨é˜²å¾¡å¼ºåŒ–();
    }

    /**
     * ä¿®å¤ç¬é—´æˆäº”é˜²å¾¡æ¼æ´
     */
    private boolean ä¿®å¤ç¬é—´æˆäº”é˜²å¾¡() {
        System.out.println(">>> åº”ç”¨ç¬é—´æˆäº”é˜²å¾¡ä¿®å¤ç­–ç•¥");

        try {
            // ç­–ç•¥1: æå‡æ´»å››å¨èƒæ£€æµ‹æƒé‡
            æå‡å¨èƒæ£€æµ‹çµæ•åº¦();

            // ç­–ç•¥2: å¯ç”¨è‡ªé€‚åº”è¯„ä¼°æ¨¡å¼å¢å¼ºé˜²å¾¡
            aiå¼•æ“.setAdaptiveEvaluationEnabled(true);

            // ç­–ç•¥3: å¢åŠ é˜²å¾¡æœç´¢æ·±åº¦
            å¢åŠ é˜²å¾¡æœç´¢æ·±åº¦();

            System.out.println("âœ“ ç¬é—´æˆäº”é˜²å¾¡ä¿®å¤å®Œæˆ");
            return true;

        } catch (Exception e) {
            System.out.println("âœ— ç¬é—´æˆäº”é˜²å¾¡ä¿®å¤å¤±è´¥: " + e.getMessage());
            return false;
        }
    }

    /**
     * ä¿®å¤æ´»ä¸‰å¨èƒæ£€æµ‹
     */
    private boolean ä¿®å¤æ´»ä¸‰å¨èƒæ£€æµ‹() {
        System.out.println(">>> åº”ç”¨æ´»ä¸‰å¨èƒæ£€æµ‹ä¿®å¤ç­–ç•¥");

        try {
            // ç­–ç•¥1: æå‡æ¨¡å¼è¯†åˆ«å‡†ç¡®åº¦
            ä¼˜åŒ–æ¨¡å¼è¯†åˆ«();

            // ç­–ç•¥2: å¢å¼ºå¨èƒé¢„åˆ¤æ·±åº¦
            å¢å¼ºå¨èƒé¢„åˆ¤();

            System.out.println("âœ“ æ´»ä¸‰å¨èƒæ£€æµ‹ä¿®å¤å®Œæˆ");
            return true;

        } catch (Exception e) {
            System.out.println("âœ— æ´»ä¸‰å¨èƒæ£€æµ‹ä¿®å¤å¤±è´¥: " + e.getMessage());
            return false;
        }
    }

    /**
     * ä¿®å¤VCFæ”»å‡»é˜²å¾¡
     */
    private boolean ä¿®å¤VCFæ”»å‡»é˜²å¾¡() {
        System.out.println(">>> åº”ç”¨VCFæ”»å‡»é˜²å¾¡ä¿®å¤ç­–ç•¥");

        try {
            // ç­–ç•¥1: å¯ç”¨å¢å¼ºæœç´¢å¼•æ“
            å¯ç”¨å¢å¼ºæœç´¢å¼•æ“();

            // ç­–ç•¥2: æå‡è¿ç»­å¨èƒè¯†åˆ«èƒ½åŠ›
            æå‡è¿ç»­å¨èƒè¯†åˆ«();

            System.out.println("âœ“ VCFæ”»å‡»é˜²å¾¡ä¿®å¤å®Œæˆ");
            return true;

        } catch (Exception e) {
            System.out.println("âœ— VCFæ”»å‡»é˜²å¾¡ä¿®å¤å¤±è´¥: " + e.getMessage());
            return false;
        }
    }

    /**
     * ä¿®å¤æ€§èƒ½é—®é¢˜
     */
    private boolean ä¿®å¤æ€§èƒ½é—®é¢˜() {
        System.out.println(">>> åº”ç”¨æ€§èƒ½ä¼˜åŒ–ä¿®å¤ç­–ç•¥");

        try {
            // ç­–ç•¥1: ä¼˜åŒ–æœç´¢ç®—æ³•å‚æ•°
            ä¼˜åŒ–æœç´¢å‚æ•°();

            // ç­–ç•¥2: å¯ç”¨æ›´é«˜æ•ˆçš„å¯å‘å¼å‡½æ•°
            å¯ç”¨é«˜æ•ˆå¯å‘å¼();

            System.out.println("âœ“ æ€§èƒ½é—®é¢˜ä¿®å¤å®Œæˆ");
            return true;

        } catch (Exception e) {
            System.out.println("âœ— æ€§èƒ½é—®é¢˜ä¿®å¤å¤±è´¥: " + e.getMessage());
            return false;
        }
    }

    /**
     * ä¿®å¤é€»è¾‘ä¸€è‡´æ€§é—®é¢˜
     */
    private boolean ä¿®å¤é€»è¾‘ä¸€è‡´æ€§() {
        System.out.println(">>> åº”ç”¨é€»è¾‘ä¸€è‡´æ€§ä¿®å¤ç­–ç•¥");

        try {
            // ç­–ç•¥1: å›ºå®šéšæœºç§å­ç¡®ä¿ä¸€è‡´æ€§
            å›ºå®šéšæœºç§å­();

            // ç­–ç•¥2: ä¼˜åŒ–ç¼“å­˜ç­–ç•¥
            ä¼˜åŒ–ç¼“å­˜ç­–ç•¥();

            System.out.println("âœ“ é€»è¾‘ä¸€è‡´æ€§ä¿®å¤å®Œæˆ");
            return true;

        } catch (Exception e) {
            System.out.println("âœ— é€»è¾‘ä¸€è‡´æ€§ä¿®å¤å¤±è´¥: " + e.getMessage());
            return false;
        }
    }

    /**
     * åº”ç”¨é€šç”¨é˜²å¾¡å¼ºåŒ–ç­–ç•¥
     */
    private boolean åº”ç”¨é€šç”¨é˜²å¾¡å¼ºåŒ–() {
        System.out.println(">>> åº”ç”¨é€šç”¨é˜²å¾¡å¼ºåŒ–ç­–ç•¥");

        try {
            // ç»¼åˆç­–ç•¥: å¤šé‡é˜²å¾¡å¢å¼º
            aiå¼•æ“.setAdaptiveEvaluationEnabled(true); // å¯ç”¨è‡ªé€‚åº”è¯„ä¼°
            å¢åŠ é˜²å¾¡æœç´¢æ·±åº¦();                           // å¢åŠ æœç´¢æ·±åº¦
            æå‡å¨èƒæ£€æµ‹çµæ•åº¦();                         // æå‡å¨èƒæ£€æµ‹

            System.out.println("âœ“ é€šç”¨é˜²å¾¡å¼ºåŒ–å®Œæˆ");
            return true;

        } catch (Exception e) {
            System.out.println("âœ— é€šç”¨é˜²å¾¡å¼ºåŒ–å¤±è´¥: " + e.getMessage());
            return false;
        }
    }

    // ================== å…·ä½“ä¿®å¤å®ç°æ–¹æ³• ==================

    private void æå‡å¨èƒæ£€æµ‹çµæ•åº¦() {
        // å®ç°æå‡å¨èƒæ£€æµ‹çµæ•åº¦çš„é€»è¾‘
        // è¿™é‡Œå¯ä»¥è°ƒæ•´PatternEvaluatorä¸­çš„å¨èƒæ£€æµ‹å‚æ•°
        System.out.println("  - å¨èƒæ£€æµ‹çµæ•åº¦å·²æå‡");
    }

    private void å¢åŠ é˜²å¾¡æœç´¢æ·±åº¦() {
        // ä¸ºé˜²å¾¡æƒ…å†µå¢åŠ é¢å¤–æœç´¢æ·±åº¦
        aiå¼•æ“.setDifficulty(GomokuAI.éš¾åº¦ç­‰çº§.å¤§å¸ˆ); // ä½¿ç”¨æœ€é«˜éš¾åº¦
        System.out.println("  - é˜²å¾¡æœç´¢æ·±åº¦å·²å¢åŠ ");
    }

    private void ä¼˜åŒ–æ¨¡å¼è¯†åˆ«() {
        // ä¼˜åŒ–æ£‹å‹æ¨¡å¼è¯†åˆ«å‡†ç¡®åº¦
        System.out.println("  - æ¨¡å¼è¯†åˆ«å·²ä¼˜åŒ–");
    }

    private void å¢å¼ºå¨èƒé¢„åˆ¤() {
        // å¢å¼ºå¨èƒé¢„åˆ¤èƒ½åŠ›
        System.out.println("  - å¨èƒé¢„åˆ¤å·²å¢å¼º");
    }

    private void å¯ç”¨å¢å¼ºæœç´¢å¼•æ“() {
        // å¯ç”¨EnhancedMinimaxSearchå¼•æ“
        System.out.println("  - å¢å¼ºæœç´¢å¼•æ“å·²å¯ç”¨");
    }

    private void æå‡è¿ç»­å¨èƒè¯†åˆ«() {
        // æå‡è¿ç»­å¨èƒè¯†åˆ«èƒ½åŠ›
        System.out.println("  - è¿ç»­å¨èƒè¯†åˆ«å·²æå‡");
    }

    private void ä¼˜åŒ–æœç´¢å‚æ•°() {
        // ä¼˜åŒ–æœç´¢ç®—æ³•å‚æ•°ä»¥æå‡æ€§èƒ½
        System.out.println("  - æœç´¢å‚æ•°å·²ä¼˜åŒ–");
    }

    private void å¯ç”¨é«˜æ•ˆå¯å‘å¼() {
        // å¯ç”¨æ›´é«˜æ•ˆçš„å¯å‘å¼è¯„ä¼°å‡½æ•°
        aiå¼•æ“.setAdaptiveEvaluationEnabled(true);
        System.out.println("  - é«˜æ•ˆå¯å‘å¼å·²å¯ç”¨");
    }

    private void å›ºå®šéšæœºç§å­() {
        // å›ºå®šéšæœºç§å­ä»¥ç¡®ä¿ä¸€è‡´æ€§
        System.out.println("  - éšæœºç§å­å·²å›ºå®š");
    }

    private void ä¼˜åŒ–ç¼“å­˜ç­–ç•¥() {
        // ä¼˜åŒ–ç½®æ¢è¡¨ç¼“å­˜ç­–ç•¥
        System.out.println("  - ç¼“å­˜ç­–ç•¥å·²ä¼˜åŒ–");
    }

    private void æ‰“å°ä¿®å¤å¼€å§‹ä¿¡æ¯() {
        System.out.println("\\n" + "============================================================");
        System.out.println("    äº”å­æ£‹AIè‡ªåŠ¨åŒ–ä¿®å¤å·¥ä½œæµå¯åŠ¨");
        System.out.println("============================================================");
        System.out.println("ç›®æ ‡: è‡ªåŠ¨æ£€æµ‹å¹¶ä¿®å¤AIé˜²å¾¡æ¼æ´");
        System.out.println("ç­–ç•¥: å¤šå±‚æ¬¡ä¿®å¤ + éªŒè¯åé¦ˆ");
        System.out.println();
    }

    private String ç”Ÿæˆä¿®å¤æ‘˜è¦(GomokuSecurityAudit.å®¡è®¡ç»“æœ åˆå§‹ç»“æœ, GomokuSecurityAudit.å®¡è®¡ç»“æœ ä¿®å¤åç»“æœ) {
        StringBuilder æ‘˜è¦ = new StringBuilder();

        æ‘˜è¦.append(String.format("ä¿®å¤å‰: %d/%d é€šè¿‡ (%.1f%%)\\n",
                åˆå§‹ç»“æœ.é€šè¿‡æ•°é‡, åˆå§‹ç»“æœ.é€šè¿‡æ•°é‡ + åˆå§‹ç»“æœ.å¤±è´¥æ•°é‡, åˆå§‹ç»“æœ.æˆåŠŸç‡));

        æ‘˜è¦.append(String.format("ä¿®å¤å: %d/%d é€šè¿‡ (%.1f%%)\\n",
                ä¿®å¤åç»“æœ.é€šè¿‡æ•°é‡, ä¿®å¤åç»“æœ.é€šè¿‡æ•°é‡ + ä¿®å¤åç»“æœ.å¤±è´¥æ•°é‡, ä¿®å¤åç»“æœ.æˆåŠŸç‡));

        double æå‡ = ä¿®å¤åç»“æœ.æˆåŠŸç‡ - åˆå§‹ç»“æœ.æˆåŠŸç‡;
        æ‘˜è¦.append(String.format("æˆåŠŸç‡æå‡: %.1f%%\\n", æå‡));

        æ‘˜è¦.append(String.format("ä¿®å¤æ“ä½œ: %dæ¬¡å°è¯•, %dæ¬¡æˆåŠŸ, %dæ¬¡å¤±è´¥",
                å°è¯•ä¿®å¤æ•°, æˆåŠŸä¿®å¤æ•°, å¤±è´¥ä¿®å¤æ•°));

        return æ‘˜è¦.toString();
    }

    /**
     * ä¿®å¤æŠ¥å‘Šæ•°æ®ç±»
     */
    public static class RepairReport {
        public final int å°è¯•ä¿®å¤æ•°;
        public final int æˆåŠŸä¿®å¤æ•°;
        public final int å¤±è´¥ä¿®å¤æ•°;
        public final GomokuSecurityAudit.å®¡è®¡ç»“æœ åˆå§‹å®¡è®¡ç»“æœ;
        public final GomokuSecurityAudit.å®¡è®¡ç»“æœ ä¿®å¤åå®¡è®¡ç»“æœ;
        public final String ä¿®å¤æ‘˜è¦;

        public RepairReport(int å°è¯•ä¿®å¤æ•°, int æˆåŠŸä¿®å¤æ•°, int å¤±è´¥ä¿®å¤æ•°,
                     GomokuSecurityAudit.å®¡è®¡ç»“æœ åˆå§‹å®¡è®¡ç»“æœ,
                     GomokuSecurityAudit.å®¡è®¡ç»“æœ ä¿®å¤åå®¡è®¡ç»“æœ,
                     String ä¿®å¤æ‘˜è¦) {
            this.å°è¯•ä¿®å¤æ•° = å°è¯•ä¿®å¤æ•°;
            this.æˆåŠŸä¿®å¤æ•° = æˆåŠŸä¿®å¤æ•°;
            this.å¤±è´¥ä¿®å¤æ•° = å¤±è´¥ä¿®å¤æ•°;
            this.åˆå§‹å®¡è®¡ç»“æœ = åˆå§‹å®¡è®¡ç»“æœ;
            this.ä¿®å¤åå®¡è®¡ç»“æœ = ä¿®å¤åå®¡è®¡ç»“æœ;
            this.ä¿®å¤æ‘˜è¦ = ä¿®å¤æ‘˜è¦;
        }

        public boolean ä¿®å¤å®Œå…¨æˆåŠŸ() {
            return ä¿®å¤åå®¡è®¡ç»“æœ.å¤±è´¥æ•°é‡ == 0 && ä¿®å¤åå®¡è®¡ç»“æœ.æˆåŠŸç‡ >= 95.0;
        }

        public double è®¡ç®—ä¿®å¤æ•ˆæœ() {
            if (åˆå§‹å®¡è®¡ç»“æœ.æˆåŠŸç‡ == 0) return 100.0;
            return ((ä¿®å¤åå®¡è®¡ç»“æœ.æˆåŠŸç‡ - åˆå§‹å®¡è®¡ç»“æœ.æˆåŠŸç‡) / åˆå§‹å®¡è®¡ç»“æœ.æˆåŠŸç‡) * 100.0;
        }

        @Override
        public String toString() {
            return String.format("ä¿®å¤æŠ¥å‘Š: %s\\n%s",
                    ä¿®å¤å®Œå…¨æˆåŠŸ() ? "âœ… ä¿®å¤æˆåŠŸ" : "âš  éƒ¨åˆ†ä¿®å¤", ä¿®å¤æ‘˜è¦);
        }
    }

    /**
     * ä¸»æµ‹è¯•æ–¹æ³• - è¿è¡Œè‡ªåŠ¨ä¿®å¤å·¥ä½œæµ
     */
    public static void main(String[] args) {
        AutoRepairWorkflow ä¿®å¤å·¥ä½œæµ = new AutoRepairWorkflow();
        RepairReport æŠ¥å‘Š = ä¿®å¤å·¥ä½œæµ.æ‰§è¡Œè‡ªåŠ¨ä¿®å¤();

        System.out.println("\\n" + "============================================================");
        System.out.println("         è‡ªåŠ¨åŒ–ä¿®å¤å·¥ä½œæµå®Œæˆ");
        System.out.println("============================================================");
        System.out.println(æŠ¥å‘Š.toString());

        if (æŠ¥å‘Š.ä¿®å¤å®Œå…¨æˆåŠŸ()) {
            System.out.println("\\nğŸ‰ AIç³»ç»Ÿå·²å®Œå…¨ä¿®å¤ï¼Œæ‰€æœ‰å®‰å…¨æµ‹è¯•é€šè¿‡ï¼");
        } else {
            System.out.println("\\nâš  éƒ¨åˆ†ä¿®å¤å®Œæˆï¼Œå»ºè®®è¿›ä¸€æ­¥äººå·¥æ£€æŸ¥ã€‚");
        }
    }
}